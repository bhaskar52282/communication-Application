<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatlist</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let CurrentUser = JSON.parse(localStorage.getItem("loggedInUser"));
    function updateChat() {
      let fullName = CurrentUser.fullName;
      let chatText = document.getElementById("chatText").value;

      let chat = {
        dateTime: new Date(),
        fullName: fullName,
        chatText: chatText
      }

      let chats = localStorage.getItem("usersChatList") ? JSON.parse(localStorage.getItem("usersChatList")) : [];
      chats.push(chat);

      if (chatText == "") {
        alert("Please enter chat text");
        return false;
      }
      localStorage.setItem("usersChatList", JSON.stringify(chats));
      return true;
    }
  </script>
</head>

<body>
  <!--Navigation bar-->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="Chatlist.html">Group Chat</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="Userlist.html">Manage users</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Documentlist.html">Manage Document</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Logout.html">Logout</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <h4>Group Chat</h4>
  <!--Start list-->
  <div>
    <ul>
      <script>
        let chats = JSON.parse(localStorage.getItem("usersChatList"));
        for (let i in chats) {
          document.write(`<li> [${chats[i].dateTime}]  ${chats[i].fullName} : ${chats[i].chatText} </li>`);
        }
      </script>
    </ul>
  </div>

  <form action="Chatlist.html" method="get" onsubmit="return updateChat()">
    <p>
      <script>document.write(CurrentUser.fullName)</script>
      <input type="text" id="chatText">
      <input type="submit" value="Send" />
      <input type="button" value="Refresh" />
    </p>
  </form>
</body>

</html>